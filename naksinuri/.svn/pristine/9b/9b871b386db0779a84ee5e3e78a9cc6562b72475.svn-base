<?php
// 매 10분 마다 실행
// */10 * * * * php -q  /home/data/cron/auto_analytics_process.php
include "_logmanager.php";
include "_database.php";

$_TAG = 'AUTO_PROSS';
$FILE_NAME = "analysis_process_".date("Y-m-d");
$row_date = date("Y-m-d H:i:s"); //현재시간
log_message($_TAG,'_________________________  start ... '.$row_date ,$FILE_NAME);
//-------------------------------------------------------------------------------
// 기간 세팅
//-------------------------------------------------------------------------------
$cur_date = date("Y-m-d");
$cur_year = date("Y");
$cur_month = date("m");
$cur_day = date("d");
$prev_date = date("Y-m-d", strtotime($cur_date." -1 day"));
$prev_year = date("Y", strtotime($cur_date." -1 day"));
$prev_month = date("m", strtotime($cur_date." -1 day"));
$prev_day = date("d", strtotime($cur_date." -1 day"));
$prev_prev_date = date("Y-m-d", strtotime($prev_date." -1 day"));
$cur_back_month_date = date("Y-m-d", strtotime($cur_date." -1 month"));
$prev_back_month_date = date("Y-m-d", strtotime($prev_date." -1 month"));
log_message($_TAG,'기준일자 : '.$cur_date ,$FILE_NAME);
log_message($_TAG,'기준-년 : '.$cur_year ,$FILE_NAME);
log_message($_TAG,'기준-월 : '.$cur_month ,$FILE_NAME);
log_message($_TAG,'기준-일 : '.$cur_day ,$FILE_NAME);
log_message($_TAG,'기준-한달전 : '.$cur_back_month_date ,$FILE_NAME);
log_message($_TAG,'과거일자 : '.$prev_date ,$FILE_NAME);
log_message($_TAG,'과거-년 : '.$prev_year ,$FILE_NAME);
log_message($_TAG,'과거-월 : '.$prev_month ,$FILE_NAME);
log_message($_TAG,'과거-일 : '.$prev_day ,$FILE_NAME);
log_message($_TAG,'과거-전일 : '.$prev_prev_date ,$FILE_NAME);
log_message($_TAG,'과거-한달전 : '.$prev_back_month_date ,$FILE_NAME);
//-------------------------------------------------------------------------------
// 어제 데이터 검증
//-------------------------------------------------------------------------------
$chksql = "
			SELECT COUNT(*) totcnt
			FROM ANLYS_DAY_TB AS T
			WHERE T.REG_DT < '{$cur_date} 00:00:00'
			AND T.VALUE_YEAR = '{$prev_year}'
			AND T.VALUE_MONTH = '{$prev_month}'
			AND T.VALUE_DAY = '{$prev_day}'
		";
$isUpdate = false;
$query = query($chksql);
$row_count = mysql_num_rows($query);
if($row_count > 0) {
	$row_data = mysql_fetch_array($query, 0);
	if($row_data['totcnt'] > 0) {
		$isUpdate = true;
	}
}
//-------------------------------------------------------------------------------
if($isUpdate) {
	//-------------------------------------------------------------------------------
	// 어제 통계 갱신 처리 진행
	//-------------------------------------------------------------------------------
	log_message($_TAG,'...어제 통계정보를 갱신합니다.',$FILE_NAME);		
	log_message($_TAG,'>> 시작',$FILE_NAME);		

		process($prev_date,$prev_year,$prev_month,$prev_day,$prev_prev_date,$prev_back_month_date);

	log_message($_TAG,'>> 종료',$FILE_NAME);		
} else {
	//-------------------------------------------------------------------------------
	// 어제 통계 갱신 처리 안함
	//-------------------------------------------------------------------------------
	log_message($_TAG,'...어제 통계정보를 변경하지 않습니다.' ,$FILE_NAME);
	log_message($_TAG,'>> 통과',$FILE_NAME);		
}
//-------------------------------------------------------------------------------
// 오늘자 통계 정보 처리
//-------------------------------------------------------------------------------
log_message($_TAG,'...오늘 통계정보를 변경합니다.' ,$FILE_NAME);
log_message($_TAG,'>> 시작',$FILE_NAME);	

	process($cur_date,$cur_year,$cur_month,$cur_day,$prev_date,$cur_back_month_date);

log_message($_TAG,'>> 종료',$FILE_NAME);		

//--------------------------------------------------
// disconnect
//--------------------------------------------------
dbclose();
//--------------------------------------------------
log_message($_TAG,'_________________________  complete ... ' ,$FILE_NAME);





//process
function process($t_date,$t_year,$t_month,$t_day,$p_date,$t_m_date) {
	global $_TAG;
	global $FILE_NAME;

	log_message($_TAG,'process 기준일자 : '.$t_date ,$FILE_NAME);
	log_message($_TAG,'process 기준-년 : '.$t_year ,$FILE_NAME);
	log_message($_TAG,'process 기준-월 : '.$t_month ,$FILE_NAME);
	log_message($_TAG,'process 기준-일 : '.$t_day ,$FILE_NAME);
	log_message($_TAG,'process 기준-한달전 : '.$t_m_date ,$FILE_NAME);
	log_message($_TAG,'process 과거일자 : '.$p_date ,$FILE_NAME);	

	//-------------------------------------------------------------------------------
	// [ 금일 일일 통계 정보 ]
	//-------------------------------------------------------------------------------
	log_message($_TAG,'[금일 일일 통계 정보] ' ,$FILE_NAME);
	{
		//-------------------------------------------------------------------------------
		// 방문자수 
		//-------------------------------------------------------------------------------
		$today_sql1 = "
					SELECT COUNT(1) totcnt 
					FROM
					(
						SELECT Ts.VISIT_IP 
						FROM ANLYS_REC_TB AS Ts 
						WHERE Ts.VISIT_IP NOT LIKE '%:%' 
							AND Ts.VISIT_TIME >= '{$t_date} 00:00:00' 
							AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
						GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3)
					) A 
					WHERE 1 = 1;
				";
		$today_qry1 = query($today_sql1);
		$today_data1 = mysql_fetch_array($today_qry1, 0)['totcnt'];
		log_message($_TAG,'[방문자수] '.$today_data1 ,$FILE_NAME);
		//log_message($_TAG,$today_sql1 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 방문횟수
		//-------------------------------------------------------------------------------
		$today_sql2 = "
					SELECT COUNT(1) totcnt 
					FROM
					(
						SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(SUBSTRING_INDEX(Ts.VISIT_TIME, ' ', 2), ':', 1), ' ', -1) AS hours
						FROM ANLYS_REC_TB AS Ts 
						WHERE Ts.VISIT_IP NOT LIKE '%:%' 
							AND Ts.VISIT_TIME >= '{$t_date} 00:00:00' 
							AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
						GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3),hours
					) A 
					WHERE 1 = 1 ;
				";
		$today_qry2 = query($today_sql2);
		$today_data2 = mysql_fetch_array($today_qry2, 0)['totcnt'];
		log_message($_TAG,'[방문횟수] '.$today_data2 ,$FILE_NAME);
		//log_message($_TAG,$today_sql2 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 재방문자수
		//-------------------------------------------------------------------------------
		$today_sql3 = "
					SELECT /*P.**/
					SUM(IF(P.t2 > 1,1,0)) totcnt
					FROM 
					(
						SELECT T.*,COUNT(1) t2
						FROM
						(
							SELECT Ts.VISIT_IP
								,Ts.VISIT_TIME
								/*,COUNT(1) t1*/
								/*,SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1) AS d*/
							FROM ANLYS_REC_TB AS Ts
							WHERE Ts.VISIT_IP NOT LIKE '%:%'
								AND Ts.VISIT_TIME >= '{$p_date} 00:00:00'
								AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
							GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3),SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1)
							ORDER BY Ts.VISIT_TIME DESC
						) T
						GROUP BY T.VISIT_IP
					) P
					WHERE 1 = 1
					AND P.VISIT_TIME >= '{$t_date} 00:00:00'
					AND P.VISIT_TIME <= '{$t_date} 23:59:59'					
				";
		$today_qry3 = query($today_sql3);
		$today_data3 = mysql_fetch_array($today_qry3, 0)['totcnt'];
		log_message($_TAG,'[재방문자수] '.$today_data3 ,$FILE_NAME);
		//log_message($_TAG,$today_sql3 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 신규방문
		//-------------------------------------------------------------------------------
		$today_sql4 = "
					SELECT /*P.**/
					SUM(IF(P.t2 <= 1,1,0)) totcnt
					FROM 
					(
						SELECT T.*,COUNT(1) t2
						FROM
						(
							SELECT Ts.VISIT_IP
								,Ts.VISIT_TIME
								/*,COUNT(1) t1*/
								/*,SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1) AS d*/
							FROM ANLYS_REC_TB AS Ts
							WHERE Ts.VISIT_IP NOT LIKE '%:%'
								/*
								AND Ts.VISIT_TIME >= '{$t_m_date} 00:00:00'
								AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
								*/
							GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3),SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1)
							ORDER BY Ts.VISIT_TIME DESC
						) T
						GROUP BY T.VISIT_IP
					) P
					WHERE 1 = 1
					AND P.VISIT_TIME >= '{$t_date} 00:00:00'
					AND P.VISIT_TIME <= '{$t_date} 23:59:59'					
				";

		$today_qry4 = query($today_sql4);
		$today_data4 = mysql_fetch_array($today_qry4, 0)['totcnt'];
		log_message($_TAG,'[신규방문] '.$today_data4 ,$FILE_NAME);
		//log_message($_TAG,$today_sql4 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 페이지뷰
		//-------------------------------------------------------------------------------
		$today_sql5 = "
						SELECT SUM(T.urltotcnt) totcnt 
						FROM 
						( 
							SELECT Ts.VISIT_URL,COUNT(1) urltotcnt 
								/* COUNT(1) urltotcnt, 
								REPLACE(Ts.VISIT_URL,SUBSTRING_INDEX(Ts.VISIT_URL,'/',3),'') AS url */ 
							FROM ANLYS_REC_TB AS Ts 
							WHERE VISIT_IP IS NOT NULL 
								AND Ts.VISIT_TIME >= '{$t_date} 00:00:00' 
								AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
							GROUP BY REPLACE(Ts.VISIT_URL,SUBSTRING_INDEX(Ts.VISIT_URL,'/',3),'') 
						) AS T 
				";
		$today_qry5 = query($today_sql5);
		$today_data5 = mysql_fetch_array($today_qry5, 0)['totcnt'];
		log_message($_TAG,'[페이지뷰] '.$today_data5 ,$FILE_NAME);
		//log_message($_TAG,$today_sql5 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 재방문자 페이지뷰
		//-------------------------------------------------------------------------------
		$today_sql6 = "
						SELECT SUM(T.urltotcnt) totcnt
						FROM 
						( 
							SELECT T2.VISIT_URL,COUNT(1) urltotcnt 
							FROM ANLYS_REC_TB AS T2 ,
							(
								SELECT P.*
								FROM 
								(
									SELECT T1.*,COUNT(1) t2
									FROM
									(
										SELECT Ts.VISIT_IP
											,Ts.VISIT_TIME
										FROM ANLYS_REC_TB AS Ts
										WHERE Ts.VISIT_IP NOT LIKE '%:%'
											AND Ts.VISIT_TIME >= '{$p_date} 00:00:00'
											AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
										GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3),SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1)
										ORDER BY Ts.VISIT_TIME DESC
									) T1
									GROUP BY T1.VISIT_IP
								) P
								WHERE 1 = 1
								AND P.VISIT_TIME >= '{$t_date} 00:00:00'
								AND P.VISIT_TIME <= '{$t_date} 23:59:59'
								AND P.t2 > 1
							) P1
							WHERE T2.VISIT_IP IS NOT NULL 
								AND T2.VISIT_TIME >= '{$t_date} 00:00:00' 
								AND T2.VISIT_TIME <= '{$t_date} 23:59:59'
								AND T2.VISIT_IP = P1.VISIT_IP
							GROUP BY REPLACE(T2.VISIT_URL,SUBSTRING_INDEX(T2.VISIT_URL,'/',3),'') 
						) AS T 		
					  ";
		$today_qry6 = query($today_sql6);
		$today_data6 = mysql_fetch_array($today_qry6, 0)['totcnt'];
		log_message($_TAG,'[페이지뷰] '.$today_data6 ,$FILE_NAME);
		//log_message($_TAG,$today_sql6 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 신규방문 페이지뷰
		//-------------------------------------------------------------------------------
		$today_sql7 = "
						SELECT SUM(T.urltotcnt) totcnt
						FROM 
						( 
							SELECT T2.VISIT_URL,COUNT(1) urltotcnt 
							FROM ANLYS_REC_TB AS T2 ,
							(
								SELECT P.*
								FROM 
								(
									SELECT T1.*,COUNT(1) t2
									FROM
									(
										SELECT Ts.VISIT_IP
											,Ts.VISIT_TIME
										FROM ANLYS_REC_TB AS Ts
										WHERE Ts.VISIT_IP NOT LIKE '%:%'
											AND Ts.VISIT_TIME >= '{$p_date} 00:00:00'
											AND Ts.VISIT_TIME <= '{$t_date} 23:59:59'
										GROUP BY SUBSTRING_INDEX(Ts.VISIT_IP, '.', 3),SUBSTRING_INDEX(Ts.VISIT_TIME,' ',1)
										ORDER BY Ts.VISIT_TIME DESC
									) T1
									GROUP BY T1.VISIT_IP
								) P
								WHERE 1 = 1
								AND P.VISIT_TIME >= '{$t_date} 00:00:00'
								AND P.VISIT_TIME <= '{$t_date} 23:59:59'
								AND P.t2 <= 1
							) P1
							WHERE T2.VISIT_IP IS NOT NULL 
								AND T2.VISIT_TIME >= '{$t_date} 00:00:00' 
								AND T2.VISIT_TIME <= '{$t_date} 23:59:59'
								AND T2.VISIT_IP = P1.VISIT_IP
							GROUP BY REPLACE(T2.VISIT_URL,SUBSTRING_INDEX(T2.VISIT_URL,'/',3),'') 
						) AS T 		
					  ";
		$today_qry7 = query($today_sql7);
		$today_data7 = mysql_fetch_array($today_qry7, 0)['totcnt'];
		log_message($_TAG,'[페이지뷰] '.$today_data7 ,$FILE_NAME);
		//log_message($_TAG,$today_sql7 ,$FILE_NAME);
		//-------------------------------------------------------------------------------
		// 오늘자 통계 반영
		//-------------------------------------------------------------------------------
		$today_deletesql = " 
				   DELETE FROM ANLYS_DAY_TB 
				   WHERE VALUE_YEAR = '{$t_year}'
						 AND VALUE_MONTH = '{$t_month}'
						 AND VALUE_DAY = '{$t_day}'						
				 ";
		//log_message($_TAG,'[통계반영-삭제] '.$today_deletesql ,$FILE_NAME);
		query($today_deletesql);

		$today_insertSql = " 
				   INSERT INTO ANLYS_DAY_TB
				   (
						VALUE_YEAR,VALUE_MONTH,VALUE_DAY,VISIT_MBR_CNT,VISIT_PV_CNT,VISIT_CNT,VISIT_RE_CNT,VISIT_RE_PV_CNT,VISIT_N_MBR_CNT,VISIT_N_MBR_PV_CNT,REG_DT,UPD_DT,VALUE_DATE
				   ) VALUES (
						'{$t_year}','{$t_month}','{$t_day}','{$today_data1}','{$today_data5}','{$today_data2}','{$today_data3}','{$today_data6}','{$today_data4}','{$today_data7}',NOW(),NOW(),'{$t_date}'
				   )
				 ";
		//log_message($_TAG,'[통계반영-재등록] '.$today_insertSql ,$FILE_NAME);
		query($today_insertSql);
	}
	//-------------------------------------------------------------------------------
	// [ 기기정보 , 모바일정보 등 추출 ]
	//-------------------------------------------------------------------------------
	log_message($_TAG,'[기기정보 , 모바일정보 등 추출] ' ,$FILE_NAME);
	{
		$today_sql6 = "
						SELECT T.*
						FROM ANLYS_REC_TB AS T
						WHERE 1 = 1 
							AND T.VISIT_TIME >= '{$t_date} 00:00:00' 
							AND T.VISIT_TIME <= '{$t_date} 23:59:59'
					  ";
		$today_qry6 = query($today_sql6);
		$today_row_count6 = mysql_num_rows($today_qry6);
		log_message($_TAG, '조회 갯수 : '.$today_row_count6 ,$FILE_NAME);
		if($today_row_count6 > 0) {

			//-------------------------------------------------------------------------------
			// 오늘자 기록 모두 삭제
			//-------------------------------------------------------------------------------

			$today_deletesql = " 
					   DELETE FROM ANLYS_INFO_TB 
					   WHERE VALUE_YEAR = '{$t_year}'
							 AND VALUE_MONTH = '{$t_month}'
							 AND VALUE_DAY = '{$t_day}'						
					 ";
			//log_message($_TAG,'[기기정보-삭제] '.$today_deletesql ,$FILE_NAME);
			query($today_deletesql);

			//-------------------------------------------------------------------------------
			// 오늘자 기록 모두 재등록
			//-------------------------------------------------------------------------------
			while ($row=mysql_fetch_array($today_qry6)) 
			{ 
				$visitbrowser = $row['VISIT_BROWSER'];
				$visitrefer = $row['VISIT_REFER'];
				//-------------------------------------------------------------------------------
				// 플랫폼 정보 추출
				//-------------------------------------------------------------------------------
				$platformnm = 'etc';		
				if(contains($visitbrowser,'windows nt 10.0')) { $platformnm = 'Windows 10';
				} else if(contains($visitbrowser,'windows nt 6.3')) { $platformnm = 'Windows 8.1'; 
				} else if(contains($visitbrowser,'windows nt 6.2')) { $platformnm = 'Windows 8'; 
				} else if(contains($visitbrowser,'windows nt 6.1')) { $platformnm = 'Windows 7'; 
				} else if(contains($visitbrowser,'windows nt 6.0')) { $platformnm = 'Windows Vista'; 
				} else if(contains($visitbrowser,'windows nt 5.2')) { $platformnm = 'Windows 2003'; 
				} else if(contains($visitbrowser,'windows nt 5.1')) { $platformnm = 'Windows XP'; 
				} else if(contains($visitbrowser,'windows nt 5.0')) { $platformnm = 'Windows 2000'; 
				} else if(contains($visitbrowser,'windows nt 4.0')) { $platformnm = 'Windows NT 4.0'; 
				} else if(contains($visitbrowser,'winnt4.0')) { $platformnm = 'Windows NT 4.0'; 
				} else if(contains($visitbrowser,'winnt 4.0')) { $platformnm = 'Windows NT'; 
				} else if(contains($visitbrowser,'winnt')) { $platformnm = 'Windows NT'; 
				} else if(contains($visitbrowser,'windows 98')) { $platformnm = 'Windows 98'; 
				} else if(contains($visitbrowser,'win98')) { $platformnm = 'Windows 98'; 
				} else if(contains($visitbrowser,'windows 95')) { $platformnm = 'Windows 95'; 
				} else if(contains($visitbrowser,'win95')) { $platformnm = 'Windows 95'; 
				} else if(contains($visitbrowser,'windows phone')) { $platformnm = 'Windows Phone'; 
				} else if(contains($visitbrowser,'windows')) { $platformnm = 'Unknown Windows OS'; 
				} else if(contains($visitbrowser,'android')) { $platformnm = 'Android'; 
				} else if(contains($visitbrowser,'blackberry')) { $platformnm = 'BlackBerry'; 
				} else if(contains($visitbrowser,'iphone')) { $platformnm = 'iOS'; 
				} else if(contains($visitbrowser,'ipad')) { $platformnm = 'iOS'; 
				} else if(contains($visitbrowser,'ipod')) { $platformnm = 'iOS'; 
				} else if(contains($visitbrowser,'os x')) { $platformnm = 'Mac OS X'; 
				} else if(contains($visitbrowser,'ppc mac')) { $platformnm = 'Power PC Mac'; 
				} else if(contains($visitbrowser,'freebsd')) { $platformnm = 'FreeBSD'; 
				} else if(contains($visitbrowser,'ppc')) { $platformnm = 'Macintosh'; 
				} else if(contains($visitbrowser,'linux')) { $platformnm = 'Linux'; 
				} else if(contains($visitbrowser,'debian')) { $platformnm = 'Debian'; 
				} else if(contains($visitbrowser,'sunos')) { $platformnm = 'Sun Solaris'; 
				} else if(contains($visitbrowser,'beos')) { $platformnm = 'BeOS'; 
				} else if(contains($visitbrowser,'apachebench')) { $platformnm = 'ApacheBench'; 
				} else if(contains($visitbrowser,'aix')) { $platformnm = 'AIX'; 
				} else if(contains($visitbrowser,'irix')) { $platformnm = 'Irix'; 
				} else if(contains($visitbrowser,'osf')) { $platformnm = 'DEC OSF'; 
				} else if(contains($visitbrowser,'hp-ux')) { $platformnm = 'HP-UX'; 
				} else if(contains($visitbrowser,'netbsd')) { $platformnm = 'NetBSD'; 
				} else if(contains($visitbrowser,'bsdi')) { $platformnm = 'BSDi'; 
				} else if(contains($visitbrowser,'openbsd')) { $platformnm = 'OpenBSD'; 
				} else if(contains($visitbrowser,'gnu')) { $platformnm = 'GNU/Linux'; 
				} else if(contains($visitbrowser,'unix')) { $platformnm = 'Unknown Unix OS'; 
				} else if(contains($visitbrowser,'symbian')) { $platformnm = 'Symbian OS'; }
				//-------------------------------------------------------------------------------
				// 브라우저 정보 추출
				//-------------------------------------------------------------------------------
				$browsernm = 'etc';
				if(contains($visitbrowser,'OPR')) { $browsernm = 'Opera';
				} else if(contains($visitbrowser,'Flock')) { $browsernm = 'Flock';
				} else if(contains($visitbrowser,'Edge')) { $browsernm = 'Spartan';
				} else if(contains($visitbrowser,'Chrome')) { $browsernm = 'Chrome';
				} else if(contains($visitbrowser,'Opera.*?Version')) { $browsernm = 'Opera';
				} else if(contains($visitbrowser,'Opera')) { $browsernm = 'Opera';
				} else if(contains($visitbrowser,'MSIE')) { $browsernm = 'Internet Explorer';
				} else if(contains($visitbrowser,'Internet Explorer')) { $browsernm = 'Internet Explorer';
				} else if(contains($visitbrowser,'Trident/4.0')) { $browsernm = 'Internet Explorer 8';
				} else if(contains($visitbrowser,'Trident/5.0')) { $browsernm = 'Internet Explorer 9';
				} else if(contains($visitbrowser,'Trident/6.0')) { $browsernm = 'Internet Explorer 10';
				} else if(contains($visitbrowser,'Trident') && contains($visitbrowser,'rv:')) { $browsernm = 'Internet Explorer 11';
				} else if(contains($visitbrowser,'Windows') && contains($visitbrowser,'Edge/')) { $browsernm = 'Internet Explorer Edge';
				} else if(contains($visitbrowser,'Shiira')) { $browsernm = 'Shiira';
				} else if(contains($visitbrowser,'Firefox')) { $browsernm = 'Firefox';
				} else if(contains($visitbrowser,'Chimera')) { $browsernm = 'Chimera';
				} else if(contains($visitbrowser,'Phoenix')) { $browsernm = 'Phoenix';
				} else if(contains($visitbrowser,'Firebird')) { $browsernm = 'Firebird';
				} else if(contains($visitbrowser,'Camino')) { $browsernm = 'Camino';
				} else if(contains($visitbrowser,'Netscape')) { $browsernm = 'Netscape';
				} else if(contains($visitbrowser,'OmniWeb')) { $browsernm = 'OmniWeb';
				} else if(contains($visitbrowser,'Safari')) { $browsernm = 'Safari';
				} else if(contains($visitbrowser,'Mozilla')) { $browsernm = 'Mozilla';
				} else if(contains($visitbrowser,'Konqueror')) { $browsernm = 'Konqueror';
				} else if(contains($visitbrowser,'icab')) { $browsernm = 'iCab';
				} else if(contains($visitbrowser,'Lynx')) { $browsernm = 'Lynx';
				} else if(contains($visitbrowser,'Links')) { $browsernm = 'Links';
				} else if(contains($visitbrowser,'hotjava')) { $browsernm = 'HotJava';
				} else if(contains($visitbrowser,'amaya')) { $browsernm = 'Amaya';
				} else if(contains($visitbrowser,'IBrowse')) { $browsernm = 'IBrowse';
				} else if(contains($visitbrowser,'Maxthon')) { $browsernm = 'Maxthon';
				} else if(contains($visitbrowser,'Ubuntu')) { $browsernm = 'Ubuntu Web Browser'; }
				//-------------------------------------------------------------------------------
				// 모바일 정보 추출
				//-------------------------------------------------------------------------------
				$mobilenm = '';
				/*// legacy array, old values commented out*/
				if(contains($visitbrowser,'mobileexplorer')) { $mobilenm = 'Mobile Explorer';
				/*
				//  'openwave'			=> 'Open Wave',
				//	'opera mini'		=> 'Opera Mini',
				//	'operamini'			=> 'Opera Mini',
				//	'elaine'			=> 'Palm',
				*/
				} else if(contains($visitbrowser,'palmsource')) { $mobilenm = 'Palm';
				/*
				//	'digital paths'		=> 'Palm',
				//	'avantgo'			=> 'Avantgo',
				//	'xiino'				=> 'Xiino',
				*/
				} else if(contains($visitbrowser,'palmscape')) { $mobilenm = 'Palmscape';
				/*
				//	'nokia'				=> 'Nokia',
				//	'ericsson'			=> 'Ericsson',
				//	'blackberry'		=> 'BlackBerry',
				//	'motorola'			=> 'Motorola'
				*/
				/*// Phones and Manufacturers*/
				} else if(contains($visitbrowser,'motorola')) { $mobilenm = 'Motorola';
				} else if(contains($visitbrowser,'nokia')) { $mobilenm = 'Nokia';
				} else if(contains($visitbrowser,'palm')) { $mobilenm = 'Palm';
				} else if(contains($visitbrowser,'iphone')) { $mobilenm = 'Apple iPhone';
				} else if(contains($visitbrowser,'ipad')) { $mobilenm = 'iPad';
				} else if(contains($visitbrowser,'ipod')) { $mobilenm = 'Apple iPod Touch';
				} else if(contains($visitbrowser,'sony')) { $mobilenm = 'Sony Ericsson';
				} else if(contains($visitbrowser,'ericsson')) { $mobilenm = 'Sony Ericsson';
				} else if(contains($visitbrowser,'blackberry')) { $mobilenm = 'BlackBerry';
				} else if(contains($visitbrowser,'cocoon')) { $mobilenm = 'O2 Cocoon';
				} else if(contains($visitbrowser,'blazer')) { $mobilenm = 'Treo';
				} else if(contains($visitbrowser,'lg')) { $mobilenm = 'LG';
				} else if(contains($visitbrowser,'amoi')) { $mobilenm = 'Amoi';
				} else if(contains($visitbrowser,'xda')) { $mobilenm = 'XDA';
				} else if(contains($visitbrowser,'mda')) { $mobilenm = 'MDA';
				} else if(contains($visitbrowser,'vario')) { $mobilenm = 'Vario';
				} else if(contains($visitbrowser,'htc')) { $mobilenm = 'HTC';
				} else if(contains($visitbrowser,'samsung')) { $mobilenm = 'Samsung';
				} else if(contains($visitbrowser,'sharp')) { $mobilenm = 'Sharp';
				} else if(contains($visitbrowser,'sie-')) { $mobilenm = 'Siemens';
				} else if(contains($visitbrowser,'alcatel')) { $mobilenm = 'Alcatel';
				} else if(contains($visitbrowser,'benq')) { $mobilenm = 'BenQ';
				} else if(contains($visitbrowser,'ipaq')) { $mobilenm = 'HP iPaq';
				} else if(contains($visitbrowser,'mot-')) { $mobilenm = 'Motorola';
				} else if(contains($visitbrowser,'playstation portable')) { $mobilenm = 'PlayStation Portable';
				} else if(contains($visitbrowser,'playstation 3')) { $mobilenm = 'PlayStation 3';
				} else if(contains($visitbrowser,'playstation vita')) { $mobilenm = 'PlayStation Vita';
				} else if(contains($visitbrowser,'hiptop')) { $mobilenm = 'Danger Hiptop';
				} else if(contains($visitbrowser,'nec-')) { $mobilenm = 'NEC';
				} else if(contains($visitbrowser,'panasonic')) { $mobilenm = 'Panasonic';
				} else if(contains($visitbrowser,'philips')) { $mobilenm = 'Philips';
				} else if(contains($visitbrowser,'sagem')) { $mobilenm = 'Sagem';
				} else if(contains($visitbrowser,'sanyo')) { $mobilenm = 'Sanyo';
				} else if(contains($visitbrowser,'spv')) { $mobilenm = 'SPV';
				} else if(contains($visitbrowser,'zte')) { $mobilenm = 'ZTE';
				} else if(contains($visitbrowser,'sendo')) { $mobilenm = 'Sendo';
				} else if(contains($visitbrowser,'nintendo dsi')) { $mobilenm = 'Nintendo DSi';
				} else if(contains($visitbrowser,'nintendo ds')) { $mobilenm = 'Nintendo DS';
				} else if(contains($visitbrowser,'nintendo 3ds')) { $mobilenm = 'Nintendo 3DS';
				} else if(contains($visitbrowser,'wii')) { $mobilenm = 'Nintendo Wii';
				} else if(contains($visitbrowser,'open web')) { $mobilenm = 'Open Web';
				} else if(contains($visitbrowser,'openweb')) { $mobilenm = 'OpenWeb';
				/*// Operating Systems*/
				} else if(contains($visitbrowser,'android')) { $mobilenm = 'Android';
				} else if(contains($visitbrowser,'symbian')) { $mobilenm = 'Symbian,';
				} else if(contains($visitbrowser,'SymbianOS')) { $mobilenm = 'SymbianOS';
				} else if(contains($visitbrowser,'elaine')) { $mobilenm = 'Palm';
				} else if(contains($visitbrowser,'series60')) { $mobilenm = 'Symbian S60';
				} else if(contains($visitbrowser,'windows ce')) { $mobilenm = 'Windows CE';
				/*// Browsers*/
				} else if(contains($visitbrowser,'obigo')) { $mobilenm = 'Obigo';
				} else if(contains($visitbrowser,'netfront')) { $mobilenm = 'Netfront Browser';
				} else if(contains($visitbrowser,'openwave')) { $mobilenm = 'Openwave Browser';
				} else if(contains($visitbrowser,'mobilexplorer')) { $mobilenm = 'Mobile Explorer';
				} else if(contains($visitbrowser,'operamini')) { $mobilenm = 'Opera Mini';
				} else if(contains($visitbrowser,'opera mini')) { $mobilenm = 'Opera Mini';
				} else if(contains($visitbrowser,'opera mobi')) { $mobilenm = 'Opera Mobile';
				} else if(contains($visitbrowser,'fennec')) { $mobilenm = 'Firefox Mobile';
				/*// Other*/
				} else if(contains($visitbrowser,'digital paths')) { $mobilenm = 'Digital Paths';
				} else if(contains($visitbrowser,'avantgo')) { $mobilenm = 'AvantGo';
				} else if(contains($visitbrowser,'xiino')) { $mobilenm = 'Xiino';
				} else if(contains($visitbrowser,'novarra')) { $mobilenm = 'Novarra Transcoder';
				} else if(contains($visitbrowser,'vodafone')) { $mobilenm = 'Vodafone';
				} else if(contains($visitbrowser,'docomo')) { $mobilenm = 'NTT DoCoMo';
				} else if(contains($visitbrowser,'o2')) { $mobilenm = 'O2';
				/*// Fallback*/
				} else if(contains($visitbrowser,'mobile')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'wireless')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'j2me')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'midp')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'cldc')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'up.link')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'up.browser')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'smartphone')) { $mobilenm = 'Generic Mobile';
				} else if(contains($visitbrowser,'cellphone')) { $mobilenm = 'Generic Mobile'; }
				//-------------------------------------------------------------------------------
				// 모바일 기기 여부 확인
				//-------------------------------------------------------------------------------
				$mobilest = 'N';
				if(!empty($mobilenm)) {
					$mobilest = 'Y';
				}
				//-------------------------------------------------------------------------------
				// 로봇 정보 추출
				//-------------------------------------------------------------------------------
				$robotnm = '';
				if(contains($visitbrowser,'googlebot')) { $robotnm = 'Googlebot';
				} else if(contains($visitbrowser,'msnbot')) { $robotnm = 'MSNBot';
				} else if(contains($visitbrowser,'baiduspider')) { $robotnm = 'Baiduspider';
				} else if(contains($visitbrowser,'bingbot')) { $robotnm = 'Bing';
				} else if(contains($visitbrowser,'slurp')) { $robotnm = 'Inktomi Slurp';
				} else if(contains($visitbrowser,'yahoo')) { $robotnm = 'Yahoo';
				} else if(contains($visitbrowser,'ask jeeves')) { $robotnm = 'Ask Jeeves';
				} else if(contains($visitbrowser,'fastcrawler')) { $robotnm = 'FastCrawler';
				} else if(contains($visitbrowser,'infoseek')) { $robotnm = 'InfoSeek Robot 1.0';
				} else if(contains($visitbrowser,'lycos')) { $robotnm = 'Lycos';
				} else if(contains($visitbrowser,'yandex')) { $robotnm = 'YandexBot';
				} else if(contains($visitbrowser,'mediapartners-google')) { $robotnm = 'MediaPartners Google';
				} else if(contains($visitbrowser,'CRAZYWEBCRAWLER')) { $robotnm = 'Crazy Webcrawler';
				} else if(contains($visitbrowser,'adsbot-google')) { $robotnm = 'AdsBot Google';
				} else if(contains($visitbrowser,'feedfetcher-google')) { $robotnm = 'Feedfetcher Google';
				} else if(contains($visitbrowser,'curious george')) { $robotnm = 'Curious George';
				} else if(contains($visitbrowser,'ia_archiver')) { $robotnm = 'Alexa Crawler';
				} else if(contains($visitbrowser,'MJ12bot')) { $robotnm = 'Majestic-12';
				} else if(contains($visitbrowser,'Uptimebot')) { $robotnm = 'Uptimebot';
				} else if(contains($visitbrowser,'yeti')) { $robotnm = 'yeti';
				} else if(contains($visitbrowser,'ahrefsbot')) { $robotnm = 'ahrefsbot';
				} else if(contains($visitbrowser,'bleriot')) { $robotnm = 'bleriot';
				} else if(contains($visitbrowser,'kisa')) { $robotnm = 'kisa';
				} else if(contains($visitbrowser,'zgrab')) { $robotnm = 'zgrab';
				} else if(contains($visitbrowser,'daum/')) { $robotnm = 'daumbot';
				} else if(contains($visitbrowser,'surdotlybot')) { $robotnm = 'surdotlybot';
				} else if(contains($visitbrowser,'kakaotalk-scrap')) { $robotnm = 'kakaotalk-scrap'; }
				//-------------------------------------------------------------------------------
				// 로봇 여부 확인
				//-------------------------------------------------------------------------------
				$robotst = 'N';
				if(!empty($robotnm)) {
					$robotst = 'Y';
				}
				//-------------------------------------------------------------------------------
				// 유입 형태 추출 / 유입 검색어 추출
				//-------------------------------------------------------------------------------
				$inputtype = '';
				$inputname = '';
				$visitrefer_encode = '';
				$parse_url_parameters = array();
				if(!empty($visitrefer)) {
					$visitrefer_encode = iconv("euc-kr", "utf-8//TRANSLIT", $visitrefer);
					parse_str(parse_url($visitrefer_encode, PHP_URL_QUERY), $parse_url_parameters);
				}
				if(contains($visitrefer,'naver.com')) { $inputtype = '네이버';
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					}
				} else if(contains($visitrefer,'daum.net')) { $inputtype = '다음';
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					}
				} else if(contains($visitrefer,'eniro.se')) { $inputtype = 'Eniro';
					if(array_key_exists('search_word',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['search_word'];
					}
				} else if(contains($visitrefer,'google.com') || contains($visitrefer,'google.co.')) { $inputtype = '구글';
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					}
				} else if(contains($visitrefer,'yahoo.com')) { $inputtype = 'Yahoo'; 
					if(array_key_exists('p',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['p'];
					} 
				} else if(contains($visitrefer,'msn.com')) { $inputtype = 'MSN'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'bing.com')) { $inputtype = 'Bing'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'aol.com')) { $inputtype = 'AOL'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
					if(array_key_exists('encquery',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['encquery'];
					} 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					}  
				} else if(contains($visitrefer,'lycos.com')) { $inputtype = 'Lycos'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
				} else if(contains($visitrefer,'ask.com')) { $inputtype = 'Ask'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'altavista.com')) { $inputtype = 'Altavista'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'search.netscape.com')) { $inputtype = 'Netscape'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
				} else if(contains($visitrefer,'cnn.com/SEARCH')) { $inputtype = 'CNN'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
				} else if(contains($visitrefer,'about.com')) { $inputtype = 'About'; 
					if(array_key_exists('terms',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['terms'];
					} 
				} else if(contains($visitrefer,'mamma.com')) { $inputtype = 'Mamma'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
				} else if(contains($visitrefer,'alltheweb.com')) { $inputtype = 'Alltheweb'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'voila.fr')) { $inputtype = 'Voila'; 
					if(array_key_exists('rdata',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['rdata'];
					} 
				} else if(contains($visitrefer,'search.virgilio.it')) { $inputtype = 'Virgilio'; 
					if(array_key_exists('qs',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['qs'];
					} 
				} else if(contains($visitrefer,'bing.com')) { $inputtype = 'Live'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'baidu.com')) { $inputtype = 'Baidu'; 
					if(array_key_exists('wd',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['wd'];
					} 
				} else if(contains($visitrefer,'alice.com')) { $inputtype = 'Alice'; 
					if(array_key_exists('qs',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['qs'];
					} 
				} else if(contains($visitrefer,'yandex.com')) { $inputtype = 'Yandex'; 
					if(array_key_exists('text',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['text'];
					} 
				} else if(contains($visitrefer,'najdi.org.mk')) { $inputtype = 'Najdi'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'seznam.cz')) { $inputtype = 'Seznam'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'search.com')) { $inputtype = 'Search'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'wp.pl')) { $inputtype = 'Wirtulana Polska'; 
					if(array_key_exists('szukaj',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['szukaj'];
					} 
				} else if(contains($visitrefer,'online.onetcenter.org')) { $inputtype = 'O*NET'; 
					if(array_key_exists('qt',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['qt'];
					} 
				} else if(contains($visitrefer,'szukacz.pl')) { $inputtype = 'Szukacz'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'yam.com')) { $inputtype = 'Yam'; 
					if(array_key_exists('k',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['k'];
					} 
				} else if(contains($visitrefer,'pchome.com')) { $inputtype = 'PCHome'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'kvasir.no')) { $inputtype = 'Kvasir'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'sesam.no')) { $inputtype = 'Sesam'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'ozu.es')) { $inputtype = 'Ozu'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'terra.com')) { $inputtype = 'Terra'; 
					if(array_key_exists('query',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['query'];
					} 
				} else if(contains($visitrefer,'mynet.com')) { $inputtype = 'Mynet'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'ekolay.net')) { $inputtype = 'Ekolay'; 
					if(array_key_exists('q',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['q'];
					} 
				} else if(contains($visitrefer,'rambler.ru')) { $inputtype = 'Rambler'; 
					if(array_key_exists('words',$parse_url_parameters)) {
						$inputname = $parse_url_parameters['words'];
					} 
				}     
				$inputname = preg_replace("/[ #\&\+\-%@=\/\\\:;,\.'\"\^`~\_|\!\?\*$#<>()\[\]\{\}]/i", "", $inputname);
				if(contains($inputname,'kakaojs')) {
					$inputname = '카카오링크URL';
				}
				if(contains($inputname,'http')) {
					$inputname = '네이버링크URL';
				}
				//-------------------------------------------------------------------------------
				// 통계반영
				//-------------------------------------------------------------------------------
				$today_insertSql = " 
							   INSERT INTO ANLYS_INFO_TB 
							   ( 
									VALUE_YEAR,VALUE_MONTH,VALUE_DAY,VISIT_FLATFORM,VISIT_BROWSER,VISIT_MOBILE,VISIT_MOBILE_ST,VISIT_ROBOT,VISIT_ROBOT_ST,VISIT_INPUT_TB,VISIT_INPUT_NM,REG_DT,UPD_DT,VALUE_DATE
							   ) VALUES ( 
									'{$t_year}','{$t_month}','{$t_day}','{$platformnm}','{$browsernm}','{$mobilenm}','{$mobilest}','{$robotnm}','{$robotst}','{$inputtype}','{$inputname}',NOW(),NOW(),'{$t_date}'
							   ); 
							 ";
				//log_message($_TAG, '[기기정보-재등록] '.$today_insertSql ,$FILE_NAME);
				query($today_insertSql);	
				//-------------------------------------------------------------------------------
			}
		}
	}
	//-------------------------------------------------------------------------------
	// [ 페이지별 일별 카운트 기록 ]
	//-------------------------------------------------------------------------------
	log_message($_TAG,'[페이지별 일별 카운트 기록] ' ,$FILE_NAME);
	{
		$today_page_sql1 = "
						SELECT  T.* 
						FROM
						(
							SELECT Ts.VISIT_PAGENM, COUNT(*) AS visitcount 
							FROM ANLYS_REC_TB AS Ts 
							WHERE 1 = 1 
								AND Ts.VISIT_TIME >= '{$t_date} 00:00:00' 
								AND Ts.VISIT_TIME <= '{$t_date} 23:59:59' 
							GROUP BY Ts.VISIT_PAGENM 
							ORDER BY visitcount DESC
						) T 
						WHERE 1 = 1 
					  ";
		$today_page_qry1 = query($today_page_sql1);
		$today_page_row_count1 = mysql_num_rows($today_page_qry1);
		log_message($_TAG, '조회 갯수 : '.$today_page_row_count1 ,$FILE_NAME);
		if($today_page_row_count1 > 0) {

			//-------------------------------------------------------------------------------
			// 오늘자 기록 모두 삭제
			//-------------------------------------------------------------------------------

			$today_deletesql = " 
					   DELETE FROM ANLYS_PAGE_TB 
					   WHERE VALUE_YEAR = '{$t_year}'
							 AND VALUE_MONTH = '{$t_month}'
							 AND VALUE_DAY = '{$t_day}'						
					 ";
			//log_message($_TAG,'[페이지정보-삭제] '.$today_deletesql ,$FILE_NAME);
			query($today_deletesql);

			//-------------------------------------------------------------------------------
			// 오늘자 기록 모두 재등록
			//-------------------------------------------------------------------------------
			while ($row=mysql_fetch_array($today_page_qry1)) 
			{ 
				$visitpagenme = $row['VISIT_PAGENM'];
				$visitpagecnt = $row['visitcount'];
				//-------------------------------------------------------------------------------
				// 통계반영
				//-------------------------------------------------------------------------------
				$today_page_insertSql = " 
							   INSERT INTO ANLYS_PAGE_TB 
							   ( 
									VALUE_YEAR,VALUE_MONTH,VALUE_DAY,VALUE_DATE,VISIT_PAGE_NM,VISIT_PAGE_CNT,REG_DT,UPD_DT
							   ) VALUES ( 
									'{$t_year}','{$t_month}','{$t_day}','{$t_date}','{$visitpagenme}','{$visitpagecnt}',NOW(),NOW()
							   ); 
							 ";
				//log_message($_TAG, '[페이지정보-재등록] '.$today_page_insertSql ,$FILE_NAME);
				query($today_page_insertSql);	
				//-------------------------------------------------------------------------------
			}
		}
	}
	//-------------------------------------------------------------------------------
	log_message($_TAG,'[처리완료] ',$FILE_NAME);
	//-------------------------------------------------------------------------------
}



//utils
function contains($target, $search)	{
	//대소문자구분
	//return strpos($target, $search) !== false;
	//대소문자구분안함
	return stripos($target, $search) !== false;	
}

?>